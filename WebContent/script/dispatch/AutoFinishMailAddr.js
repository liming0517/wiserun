var g_ArrEmailList;var g_MainDiv=null;var g_Body=null;var g_FirstTd=null;var g_CurrentTd=null;var g_InputObject=null;var g_OldInnerTxt="";var g_NewInnerTxt="";var g_TdCssClassName="autofinish_over";var g_TbCssClassName="autofinish";function f_OnKeyDown(){var e=window.event.srcElement;if(e!=g_InputObject){if(g_MainDiv!=null){g_MainDiv.innerHTML="";g_MainDiv=null;};g_OldInnerTxt="";g_NewInnerTxt="";g_FirstTd=null;g_CurrentTd=null;g_InputObject=e;};f_InitMain();var kc=window.event.keyCode;switch(kc){case 13:f_EnterKey();f_SetDivDisplay(false);return false;break;case 27:f_EscapeKey();f_SetDivDisplay(false);return false;break;case 8:f_BackSpaceKey();return;break;case 38:f_UpKey();return;break;case 40:f_DownKey();return;break;default:break;};return true;};function f_OnKeyUp(){var kc=window.event.keyCode;var sTemp="13,27,38,40,9,116,";kc=kc+"";if(sTemp.indexOf(kc)>-1){return false;};f_InitDivData();if(g_NewInnerTxt==""&&kc!=32){f_SetDivDisplay(false);}else{f_SetDivDisplay(true);};};function f_OnKeyPress(){return;};function f_OnChange(){return;};function f_OnBlur(){if(g_InputObject==null){return;};var s=g_InputObject.value;var x=s.substr(s.length-1,1);if(x==","||x==";"){g_InputObject.value=s.substr(0,s.length-1);};return;};function f_OnPasete(){return;};function f_InitMain(){if(g_Body==null){g_Body=document.body;};if(g_MainDiv==null){g_MainDiv=f_CreateDiv();g_Body.insertAdjacentElement("beforeEnd",g_MainDiv);f_SetDivPosition();};};function f_CreateDiv(){var div=document.createElement("<DIV></DIV>");div.id="divEmailAddressMain";div.style.position="absolute";div.style.display="";return div;};function f_SetDivDisplay(bTrue){if(bTrue){g_MainDiv.style.display="";}else{g_MainDiv.style.display="none";};};function f_SetDivPosition(){var e=window.event.srcElement;g_MainDiv.style.left=f_GetX(e)+1;g_MainDiv.style.top=f_GetY(e)+24;};function f_GetX(e){var l=e.offsetLeft;while(e=e.offsetParent){l+=e.offsetLeft;};return l;};function f_GetY(e){var t=e.offsetTop;while(e=e.offsetParent){t+=e.offsetTop;};return t;};function f_CreateTable(){var oTable=document.createElement("<table border=\"0\" cellspacing=\"2\" cellpadding=\"2\">");oTable.className=g_TbCssClassName;return oTable;};function f_CreateRow(table){var rowNode=table.insertRow();return rowNode;};function f_CreateColumn(row,i){var colNode=row.insertCell();colNode.id="tdACMA_"+i;colNode.zIndex=i;colNode.style.cursor="hand";colNode.onmouseover=f_TdOnmouseover;colNode.onmouseout=f_TdOnmouseout;colNode.onclick=f_TdOnclick;if(i==0){colNode.className=g_TdCssClassName;g_FirstTd=colNode;g_CurrentTd=colNode;}else{colNode.className="";};return colNode;};function f_TdOnmouseover(){var o=window.event.srcElement;while(o.tagName!="TD"){o=o.parentNode;};o.className="";if(g_CurrentTd!=null){g_CurrentTd.className="";};g_CurrentTd=o;g_CurrentTd.className=g_TdCssClassName;};function f_TdOnmouseout(){var o=window.event.srcElement;while(o.tagName!="TD"){o=o.parentNode;};o.className="";if(g_CurrentTd!=null){g_CurrentTd.className="";};g_CurrentTd=g_FirstTd;g_CurrentTd.className=g_TdCssClassName;};function f_TdOnclick(){f_FillCurrentEmail();};function f_FillCurrentEmail(){if(g_CurrentTd==null||g_InputObject==null){return;};if(g_ArrEmailList==null||g_ArrEmailList.length==0){return;};var i=parseInt(g_CurrentTd.zIndex);var s=g_OldInnerTxt;if(g_OldInnerTxt!=""){s+=",";};g_InputObject.focus();g_InputObject.value=s+"\""+g_ArrEmailList[i][0]+"\" "+"<"+g_ArrEmailList[i][1]+">,";f_SetDivDisplay(false);g_CurrentTd=null;};function f_InitDivData(){var oTb,oTr,oTd;g_ArrEmailList=f_GetArrEmailList();if(g_ArrEmailList!=null){g_MainDiv.innerHTML="";oTb=f_CreateTable();g_MainDiv.insertAdjacentElement("beforeEnd",oTb);for(var i=0;i<g_ArrEmailList.length;i++){oTr=f_CreateRow(oTb);oTd=f_CreateColumn(oTr,i);oTd.innerHTML="&quot;"+g_ArrEmailList[i][0]+"&quot;&nbsp;&lt;"+g_ArrEmailList[i][1]+"&gt;";};};};function f_GetArrEmailList(){if(g_InputObject==null){return null;};var s=g_InputObject.value;var k=s.length;var iLastSign=0;if(s.lastIndexOf(",")>s.lastIndexOf(";")){iLastSign=s.lastIndexOf(",");}else{iLastSign=s.lastIndexOf(";");};g_NewInnerTxt=s.substring(iLastSign+1,k);if(window.event.keyCode==8){g_NewInnerTxt=s.substring(iLastSign+1,k-1);};g_NewInnerTxt=f_Trim(g_NewInnerTxt);g_OldInnerTxt=s.substring(0,iLastSign);g_OldInnerTxt=f_Trim(g_OldInnerTxt);var arr=new Array();var re;var j=0;if(g_NewInnerTxt==""){if(window.event.keyCode==32)arr=gArrEmailAddress;}else{try{re=RegExp("^"+g_NewInnerTxt,"i");for(var i=0;i<gArrEmailAddress.length;i++){if(re.test(gArrEmailAddress[i][0])||re.test(gArrEmailAddress[i][1])){arr[j]=gArrEmailAddress[i];j++;};};}catch(ex){};};return arr;};function f_EnterKey(){f_FillCurrentEmail();};function f_EscapeKey(){return;};function f_BackSpaceKey(){f_InitDivData();if(g_NewInnerTxt==""){f_SetDivDisplay(false);}else{f_SetDivDisplay(true);};};function f_UpKey(){if(g_CurrentTd==null){return;};var k=g_CurrentTd.zIndex-1;if(k==-1){k+=1;};var oTd=document.getElementById("tdACMA_"+k);g_CurrentTd.className="";g_CurrentTd=oTd;g_CurrentTd.className=g_TdCssClassName;f_SetDivDisplay(true);};function f_DownKey(){if(g_CurrentTd==null){return;};var k=g_CurrentTd.zIndex+1;if(k==g_ArrEmailList.length){k-=1;};var oTd=document.getElementById("tdACMA_"+k);g_CurrentTd.className="";g_CurrentTd=oTd;g_CurrentTd.className=g_TdCssClassName;f_SetDivDisplay(true);};function f_Trim(str){str=str.replace(/(^\s*)|(\s*$)/g,"");return str;};
